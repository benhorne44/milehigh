<div class="container">
  <div class="row">
    <div class="span12">
      <h3 class="modal-title" id="storeShowModalLabel"><%= @store.name %>: Store Details</h3>
      <div id="store-info">
        <img src="http://www.placekitten.com/250/250" id="store-show-image"/>
        <p>Address:<br/>
        <%= @store.address %><br/>
        <%= @store.city %><br/>
        <%= @store.state %><br/>
        <%= @store.zipcode %></p>

  <p>Hours: <%= @store.hours %></p>
  <p>Website: <%= @store.website %></p>
  <p>Phone Number: <%= @store.phone_number %></p>
</div>
<div id='single-store-map' class='light'></div>
  <script type='text/javascript'>
    var params = document.body.baseURI.split('/');
    var storeSlug = params[params.length-1]
    queryData = { query : storeSlug };
    $(document).ready(function(e) { 
      $.ajax({
        url: '/search',
        type: 'POST',
        dataType: 'json',
        data: queryData,
        success: function(response) {
          console.log(response[0]["lat"]);
          console.log(response[0]["lng"]);
          var map = L.mapbox.map('single-store-map', 'examples.map-20v6611k').setView([response[0]["lat"], response[0]["lng"]], 16);
          addToMap(response[0], map);

        },
        error: function(response) {
          var errors = response.responseJSON;
          if(errors) {
            $('#flash-section').html(errors);
          }
        }
      })
    })
    

    var addToMap = function(store, map) {
      L.mapbox.markerLayer({
        // this feature is in the GeoJSON format: see geojson.org
        // for the full specification
        type: 'Feature',
        geometry: {
            type: 'Point',
            // coordinates here are in longitude, latitude order because
            // x, y is the standard for GeoJSON and many formats
            coordinates: [parseFloat(store["lng"]), parseFloat(store["lat"])]
        },
        properties: {
            title: "<a href='/'>" + store["name"] + '</a>',
            description: store["address"],
            // one can customize markers by adding simplestyle properties
            // http://mapbox.com/developers/simplestyle/
            'marker-size': 'large',
            'marker-color': '#f0a'
        }
      }).addTo(map);
    };
  </script>
<!-- <div id="store-menu">
  <br>
  <hr/>
  <h3>Menu</h3>
  <%# @menu.each do |strain| %>
    <p><%# link_to strain.name, "#" %></p>
  <%# end %>
</div> -->

      <%= render partial: 'reviews/new' %>

      <div id="store-menu">
        <br>
        <hr/>
        <h3>Strains</h3>
        <% @strains.each do |strain| %>
          <p><%= link_to strain.name, strain_show_path(strain.key) %></p>
        <% end %>
      </div>
    </div>
  </div>
</div>
